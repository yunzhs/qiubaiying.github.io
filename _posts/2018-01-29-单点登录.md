---
layout:     post
title:      单点登录
date:       2018-1-29
author:     yunzhs
header-img: img/Archer.jpg
catalog: true
tags:
    - 单点登录
typora-root-url: ..
typora-copy-images-to: ..\img\posts
---

## 1. 什么是单点登录

​	单点登录（Single Sign On）,意义是在多个应用系统中，用户只需要登录一次就可以访问所有相互信任的应用系统。举个栗子,就是去动物园买一张套票,就可以访问套票锁包含的所有景点.

### SSO单点登录访问流程主要有以下步骤：

1. 访问服务：SSO客户端发送请求访问应用系统提供的服务资源。


2. 定向认证：SSO客户端会重定向用户请求到SSO服务器。

3. 用户认证：用户身份认证。

4. 发放票据：SSO服务器会产生一个随机的Service Ticket。

5. 验证票据：SSO服务器验证票据Service Ticket的合法性，验证通过后，允许客户端访问服务。

6. 传输用户信息：SSO服务器验证票据通过后，传输用户认证结果信息给客户端。 


## 2.使用CAS的一些的基本配置部署

Cas(Central Authentication Service )服务端其实就是一个war包.将它导入到tomcat的webapp文件中,执行startup.sh命令将其解压就可以对其的配置文件进行一系列的操作了.

```
<bean class="org.jasig.cas.authentication.handler.support.HttpBasedServiceCredentialsAuthenticationHandler"
p:httpClient-ref="httpClient"/>
这里需要增加参数p:requireSecure="false"，requireSecure属性意思为是否需要安全验证，即HTTPS，false为不采用
```

修改cas的/WEB-INF/[spring](http://lib.csdn.net/base/javaee)-configuration/ticketGrantingTicketCookieGenerator.xml找到下面配置

```
<bean id="ticketGrantingTicketCookieGenerator" class="org.jasig.cas.web.support.CookieRetrievingCookieGenerator"
      p:cookieSecure="true"
      p:cookieMaxAge="-1"
      p:cookieName="CASTGC"
      p:cookiePath="/cas" />
```

参数p:cookieSecure="true"，同理为HTTPS验证相关，TRUE为采用HTTPS验证，FALSE为不采用https验证。

参数p:cookieMaxAge="-1"，是COOKIE的最大生命周期，-1为无生命周期，即只在当前打开的窗口有效，关闭或重新打开其它窗口，仍会要求验证。可以根据需要修改为大于0的数字，比如3600等，意思是在3600秒内，打开任意窗口，都不需要验证。

我们这里将cookieSecure改为false ,  cookieMaxAge 改为3600



修改cas的WEB-INF/spring-configuration/warnCookieGenerator.xml

```
<bean id="warnCookieGenerator" class="org.jasig.cas.web.support.CookieRetrievingCookieGenerator"
p:cookieSecure="true"
p:cookieMaxAge="-1"
p:cookieName="CASPRIVACY"
p:cookiePath="/cas" />
```

同理